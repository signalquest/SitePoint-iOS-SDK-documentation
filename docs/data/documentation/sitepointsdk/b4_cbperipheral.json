{"schemaVersion":{"minor":3,"major":0,"patch":0},"metadata":{"title":"CBPeripheral","modules":[{"name":"SitePointSdk"}],"roleHeading":"Article","role":"article"},"sections":[],"abstract":[{"type":"text","text":"Set up CBPeripheral to interface with a connected SitePoint Bluetooth device."}],"primaryContentSections":[{"kind":"content","content":[{"level":2,"anchor":"Overview","type":"heading","text":"Overview"},{"inlineContent":[{"text":"The CBPeripheral handles reading and writing SignalQuest and RTCM messages with the connected SitePoint.","type":"text"}],"type":"paragraph"},{"text":"Reference the example app","level":3,"type":"heading","anchor":"Reference-the-example-app"},{"inlineContent":[{"type":"text","text":"In the SitePoint iOS Example App, the "},{"type":"codeVoice","code":"CBPeripheral"},{"text":" code is in ","type":"text"},{"code":"SitePoint.swift","type":"codeVoice"},{"text":".","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"This included SitePointPeripheral class conforms to ","type":"text"},{"code":"CBPeripheralDelegate","type":"codeVoice"},{"text":" to attach to, read, and write Bluetooth characteristics.","type":"text"}]},{"content":[{"inlineContent":[{"type":"text","text":"SitePointPeripheral uses message handling functions to interface with the SDK, covered later."}],"type":"paragraph"}],"type":"aside","style":"tip","name":"Tip"},{"level":3,"text":"Handle connection initiated by CBCentralManager","type":"heading","anchor":"Handle-connection-initiated-by-CBCentralManager"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In "},{"identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B3_CBCentralManager","isActive":true,"type":"reference"},{"text":", the connection to a specific SitePoint peripheral was initiated.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The CBCenteralManagerDelegate, on receiving a SitePoint connection, calls SitePointPeripheral’s’ "},{"code":"didConnect","type":"codeVoice"},{"type":"text","text":" method, allowing it to set itself as the CBPeripheralDelegate for that SitePoint."}]},{"type":"codeListing","syntax":"swift","code":["func didConnect(_ peripheral: CBPeripheral) {","    self.peripheral = peripheral","    name = peripheral.name","    peripheral.delegate = self","}"]},{"type":"aside","style":"note","content":[{"type":"paragraph","inlineContent":[{"text":"The SitePoint iOS Example app uses a delegate that conforms to CBPeripheralDelegate to handle callbacks.","type":"text"}]}],"name":"Note"},{"inlineContent":[{"type":"text","text":"As noted previosly, the "},{"type":"reference","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B3_CBCentralManager","isActive":true},{"type":"text","text":" initiated a "},{"type":"codeVoice","code":"discoverServices"},{"text":" call.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"Because ","type":"text"},{"code":"self","type":"codeVoice"},{"text":" is set as the CBPeripheral’s delegate, the callback for ","type":"text"},{"type":"codeVoice","code":"didDiscoverServices"},{"type":"text","text":" will be called and returns the services discovered."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"To discover the characteristics within each service, iterate the services to find the one with "},{"code":"sitePointServiceUuid","type":"codeVoice"},{"type":"text","text":" (00000100-34ed-12ef-63f4-317792041d17), and pass it into a "},{"type":"codeVoice","code":"peripheral.discoverCharacteristics"},{"text":" call.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"These characteristics will then be available in the CBPeripheralDelegate’s "},{"code":"didDiscoverCharacteristicsFor","type":"codeVoice"},{"text":" method, and can be bound for future use.","type":"text"}]},{"anchor":"Receiving-SitePoint-location-and-status-data","type":"heading","text":"Receiving SitePoint location and status data","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"To receive the SitePoint’s location and status data, the incoming messages on the "},{"type":"codeVoice","code":"messageCharacteristic"},{"text":" are parsed. This is handled in the ","type":"text"},{"type":"codeVoice","code":"didUpdateValueFor"},{"type":"text","text":" callback, which is called when the characteristic has received data."}]},{"type":"paragraph","inlineContent":[{"text":"The messages are sent to the ","type":"text"},{"type":"codeVoice","code":"MessageHandler"},{"type":"text","text":" in the SDK, and return structured "},{"identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/Location","isActive":true,"type":"reference"},{"text":" and ","type":"text"},{"type":"reference","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/Status","isActive":true},{"text":" data.","type":"text"}]},{"text":"Sending RTCM messages to the SitePoint","anchor":"Sending-RTCM-messages-to-the-SitePoint","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"rtcmCharacteristic","type":"codeVoice"},{"text":" is used to send RTCM messages from an NTRIP service to the SitePoint. This allows the SitePoint to get to near centimeter-level accuracy.","type":"text"}]},{"inlineContent":[{"type":"text","text":"The next section will cover sending RTCM messages received from an NTRIP service to the SitePoint."}],"type":"paragraph"},{"text":"Read Next","type":"heading","level":2,"anchor":"Read-Next"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B5_NTRIP"}]}]}],"type":"unorderedList"}]}],"kind":"article","hierarchy":{"paths":[["doc:\/\/SitePointSdk\/documentation\/SitePointSdk"]]},"seeAlsoSections":[{"title":"Implementation","identifiers":["doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B1_Implementation-Guide","doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B2_Permissions","doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B3_CBCentralManager","doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B5_NTRIP"],"generated":true}],"identifier":{"url":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B4_CBPeripheral","interfaceLanguage":"swift"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/sitepointsdk\/b4_cbperipheral"]}],"references":{"doc://SitePointSdk/documentation/SitePointSdk/B3_CBCentralManager":{"url":"\/documentation\/sitepointsdk\/b3_cbcentralmanager","type":"topic","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B3_CBCentralManager","abstract":[{"type":"text","text":"Set up "},{"code":"CBCentralManager","type":"codeVoice"},{"text":" to scan for and connect to SitePoint Bluetooth devices.","type":"text"}],"kind":"article","title":"CBCentralManager","role":"article"},"doc://SitePointSdk/documentation/SitePointSdk/B1_Implementation-Guide":{"title":"Implementation Guide","abstract":[{"text":"Review example app code to use the SitePoint SDK with Bluetooth and NTRIP.","type":"text"}],"type":"topic","url":"\/documentation\/sitepointsdk\/b1_implementation-guide","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B1_Implementation-Guide","kind":"article","role":"article"},"doc://SitePointSdk/documentation/SitePointSdk":{"role":"collection","kind":"symbol","abstract":[{"type":"text","text":"Provides an API and utilities for interfacing with SignalQuest’s SitePoint GNSS devices."}],"title":"SitePointSdk","url":"\/documentation\/sitepointsdk","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk","type":"topic"},"doc://SitePointSdk/documentation/SitePointSdk/B2_Permissions":{"url":"\/documentation\/sitepointsdk\/b2_permissions","type":"topic","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B2_Permissions","abstract":[{"text":"Add permissions for Bluetooth and Location services.","type":"text"}],"kind":"article","title":"Permissions","role":"article"},"doc://SitePointSdk/documentation/SitePointSdk/Location":{"role":"symbol","navigatorTitle":[{"kind":"identifier","text":"Location"}],"title":"Location","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"text":"Location","kind":"identifier"}],"abstract":[],"kind":"symbol","type":"topic","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/Location","url":"\/documentation\/sitepointsdk\/location"},"doc://SitePointSdk/documentation/SitePointSdk/Status":{"role":"symbol","abstract":[],"kind":"symbol","title":"Status","url":"\/documentation\/sitepointsdk\/status","fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"Status"}],"navigatorTitle":[{"text":"Status","kind":"identifier"}],"identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/Status","type":"topic"},"doc://SitePointSdk/documentation/SitePointSdk/B5_NTRIP":{"url":"\/documentation\/sitepointsdk\/b5_ntrip","type":"topic","identifier":"doc:\/\/SitePointSdk\/documentation\/SitePointSdk\/B5_NTRIP","abstract":[{"text":"Set up NTRIP connection handling and RTCM parsing for aiding the SitePoint.","type":"text"}],"kind":"article","title":"NTRIP","role":"article"}}}